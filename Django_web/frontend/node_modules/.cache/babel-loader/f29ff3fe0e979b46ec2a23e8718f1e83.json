{"ast":null,"code":"import _asyncToGenerator from\"C:\\\\Users\\\\drago\\\\Documents\\\\Github Repository VSCode\\\\DB_end_project\\\\Django_web\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"C:\\\\Users\\\\drago\\\\Documents\\\\Github Repository VSCode\\\\DB_end_project\\\\Django_web\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\drago\\\\Documents\\\\Github Repository VSCode\\\\DB_end_project\\\\Django_web\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import{createContext,useState,useEffect}from\"react\";import jwt_decode from\"jwt-decode\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/createContext();export default AuthContext;export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(function(){return localStorage.getItem(\"authTokens\")?JSON.parse(localStorage.getItem(\"authTokens\")):null;}),_useState2=_slicedToArray(_useState,2),authTokens=_useState2[0],setAuthTokens=_useState2[1];var _useState3=useState(function(){return localStorage.getItem(\"authTokens\")?jwt_decode(localStorage.getItem(\"authTokens\")):null;}),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var loginUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.next=3;return fetch(\"http://127.0.0.1:8000/api/token/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({email:e.target.email.value,password:e.target.password.value})});case 3:response=_context.sent;_context.next=6;return response.json();case 6:data=_context.sent;if(response.status===200){setAuthTokens(data);setUser(jwt_decode(data.access));localStorage.setItem(\"authTokens\",JSON.stringify(data));}else{alert(\"Something went wrong!\");}case 8:case\"end\":return _context.stop();}}},_callee);}));return function loginUser(_x){return _ref2.apply(this,arguments);};}();var logoutUser=function logoutUser(){setAuthTokens(null);setUser(null);localStorage.removeItem(\"authTokens\");};var updateToken=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var response,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(\"Updated token\");_context2.next=3;return fetch(\"http://127.0.0.1:8000/api/token/refresh/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({refresh:authTokens===null||authTokens===void 0?void 0:authTokens.refresh})});case 3:response=_context2.sent;_context2.next=6;return response.json();case 6:data=_context2.sent;if(response.status===200){setAuthTokens(data);setUser(jwt_decode(data.access));localStorage.setItem(\"authTokens\",JSON.stringify(data));}else{logoutUser();}if(loading){setLoading(false);}case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function updateToken(){return _ref3.apply(this,arguments);};}();var register=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(x){var response,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return fetch(\"/api/register/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({username:x.target.username2.value,password:x.target.password2.value,password2:x.target.password22.value,email:x.target.email2.value,first_name:x.target.first_name.value,last_name:x.target.last_name.value,phone:x.target.phone.value,gender:x.target.gender.value,address:x.target.address.value})});case 2:response=_context3.sent;_context3.next=5;return response.json();case 5:data=_context3.sent;if(response.status===200){alert(\"Register success\");}else{alert(\"Register failed\");}case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function register(_x2){return _ref4.apply(this,arguments);};}();var _useState7=useState(\"default\"),_useState8=_slicedToArray(_useState7,2),value=_useState8[0],setValue=_useState8[1];var contextData={user:user,authTokens:authTokens,loginUser:loginUser,logoutUser:logoutUser,register:register,value:value,setValue:setValue};useEffect(function(){if(loading){updateToken();}var fourMinutes=1000*60*4;var interval=setInterval(function(){if(authTokens){updateToken();}},fourMinutes);return function(){return clearInterval(interval);};},[authTokens,loading]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextData,children:loading?null:children});};","map":{"version":3,"sources":["C:/Users/drago/Documents/Github Repository VSCode/DB_end_project/Django_web/frontend/src/utils/AuthContext.jsx"],"names":["createContext","useState","useEffect","jwt_decode","AuthContext","AuthProvider","children","localStorage","getItem","JSON","parse","authTokens","setAuthTokens","user","setUser","loading","setLoading","loginUser","e","preventDefault","fetch","method","headers","body","stringify","email","target","value","password","response","json","data","status","access","setItem","alert","logoutUser","removeItem","updateToken","console","log","refresh","register","x","username","username2","password2","password22","email2","first_name","last_name","phone","gender","address","setValue","contextData","fourMinutes","interval","setInterval","clearInterval"],"mappings":"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","sourcesContent":["import { createContext, useState, useEffect } from \"react\";\r\nimport jwt_decode from \"jwt-decode\";\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport default AuthContext;\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  let [authTokens, setAuthTokens] = useState(() =>\r\n    localStorage.getItem(\"authTokens\")\r\n      ? JSON.parse(localStorage.getItem(\"authTokens\"))\r\n      : null\r\n  );\r\n  let [user, setUser] = useState(() =>\r\n    localStorage.getItem(\"authTokens\")\r\n      ? jwt_decode(localStorage.getItem(\"authTokens\"))\r\n      : null\r\n  );\r\n  let [loading, setLoading] = useState(true);\r\n\r\n  let loginUser = async (e) => {\r\n    e.preventDefault();\r\n    let response = await fetch(\"http://127.0.0.1:8000/api/token/\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        email: e.target.email.value,\r\n        password: e.target.password.value,\r\n      }),\r\n    });\r\n    let data = await response.json();\r\n\r\n    if (response.status === 200) {\r\n      setAuthTokens(data);\r\n      setUser(jwt_decode(data.access));\r\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\r\n    } else {\r\n      alert(\"Something went wrong!\");\r\n    }\r\n  };\r\n\r\n  let logoutUser = () => {\r\n    setAuthTokens(null);\r\n    setUser(null);\r\n    localStorage.removeItem(\"authTokens\");\r\n  };\r\n\r\n  let updateToken = async () => {\r\n    console.log(\"Updated token\");\r\n    let response = await fetch(\"http://127.0.0.1:8000/api/token/refresh/\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({ refresh: authTokens?.refresh }),\r\n    });\r\n    let data = await response.json();\r\n\r\n    if (response.status === 200) {\r\n      setAuthTokens(data);\r\n      setUser(jwt_decode(data.access));\r\n      localStorage.setItem(\"authTokens\", JSON.stringify(data));\r\n    } else {\r\n      logoutUser();\r\n    }\r\n\r\n    if (loading) {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  let register = async (x) => {\r\n    let response = await fetch(\"/api/register/\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        username: x.target.username2.value,\r\n        password: x.target.password2.value,\r\n        password2: x.target.password22.value,\r\n        email: x.target.email2.value,\r\n        first_name: x.target.first_name.value,\r\n        last_name: x.target.last_name.value,\r\n        phone: x.target.phone.value,\r\n        gender: x.target.gender.value,\r\n        address: x.target.address.value,\r\n      }),\r\n    });\r\n    let data = await response.json();\r\n\r\n    if (response.status === 200) {\r\n      alert(\"Register success\");\r\n    } else {\r\n      alert(\"Register failed\");\r\n    }\r\n  };\r\n\r\n  let [value, setValue] = useState(\"default\");\r\n\r\n  let contextData = {\r\n    user: user,\r\n    authTokens: authTokens,\r\n    loginUser: loginUser,\r\n    logoutUser: logoutUser,\r\n    register: register,\r\n    value: value,\r\n    setValue: setValue,\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (loading) {\r\n      updateToken();\r\n    }\r\n\r\n    let fourMinutes = 1000 * 60 * 4;\r\n    let interval = setInterval(() => {\r\n      if (authTokens) {\r\n        updateToken();\r\n      }\r\n    }, fourMinutes);\r\n    return () => clearInterval(interval);\r\n  }, [authTokens, loading]);\r\n\r\n  return (\r\n    <AuthContext.Provider value={contextData}>\r\n      {loading ? null : children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}